# 内网穿透使用说明

## 1. 服务器端设置

### 1.1 启动后台管理服务器

1. 首先确保已安装Python环境（建议Python 3.8+）
2. 打开命令行终端，进入项目根目录
3. 执行以下命令启动后台管理服务器：

```bash
python admin_server.py
```

4. 服务器将在端口8080上启动，控制台将显示类似以下信息：

```
服务器启动成功！
本地访问地址: http://localhost:8080
外部访问地址: http://192.168.1.100:8080
```

### 1.2 配置内网穿透

#### 方式一：使用花生壳（推荐）

1. 下载并安装花生壳客户端：https://hsk.oray.com/download/
2. 注册并登录花生壳账号
3. 添加映射：
   - 映射名称：自定义（如"黑名单管理"）
   - 应用类型：HTTP
   - 内网主机：服务器的内网IP地址（如192.168.1.100）
   - 内网端口：8080
   - 点击"保存"
4. 花生壳将生成一个外网访问地址（如http://xxxxxx.vip.gz.gs:xxxxx）

#### 方式二：使用ngrok

1. 注册ngrok账号并下载客户端：https://ngrok.com/
2. 解压并运行ngrok客户端
3. 执行以下命令：

```bash
ngrok http 8080
```

4. ngrok将生成一个外网访问地址（如https://xxxxxx.ngrok.io）

## 2. 客户端设置

### 2.1 启动主程序

1. 在客户端电脑上运行 `Compares_Excel_PySide6.exe`（Windows）或通过Python启动：

```bash
python Compares_Excel_PySide6.py
```

2. 在登录界面中，输入服务器配置：
   - 服务器地址：花生壳或ngrok生成的外网访问地址（如http://xxxxxx.vip.gz.gs）
   - 服务器端口：花生壳或ngrok生成的端口号（如8080或生成的自定义端口）
   - 用户名：admin
   - 密码：admin

3. 点击"登录"按钮

### 2.2 配置说明

- 如果客户端和服务器在同一局域网内，可以直接使用服务器的内网IP地址和端口8080
- 如果客户端和服务器不在同一局域网内，必须使用内网穿透生成的外网地址和端口
- 确保服务器防火墙已允许端口8080的访问

## 3. 常见问题排查

### 3.1 无法连接到服务器

1. 检查服务器是否已启动
2. 检查服务器防火墙是否允许端口8080的访问
3. 检查内网穿透服务是否正常运行
4. 检查客户端输入的服务器地址和端口是否正确

### 3.2 登录失败

1. 检查用户名和密码是否正确
2. 检查服务器地址和端口是否正确
3. 检查服务器日志是否有错误信息

### 3.3 数据同步问题

1. 检查网络连接是否稳定
2. 检查服务器数据库是否正常运行
3. 检查客户端是否使用了正确的服务器地址

## 4. 高级设置

### 4.1 修改服务器端口

在 `admin_server.py` 文件中，找到以下代码并修改端口号：

```python
PORT = 8080  # 修改为您需要的端口号
```

### 4.2 添加防火墙规则

#### Windows系统

1. 打开"控制面板" -> "系统和安全" -> "Windows Defender 防火墙"
2. 点击"高级设置"
3. 在左侧面板中点击"入站规则"
4. 点击"新建规则"
5. 选择"端口"，点击"下一步"
6. 选择"TCP"，输入端口号8080，点击"下一步"
7. 选择"允许连接"，点击"下一步"
8. 选择适用的网络类型，点击"下一步"
9. 输入规则名称（如"黑名单管理服务器"），点击"完成"

#### Linux系统

```bash
sudo ufw allow 8080/tcp
sudo ufw reload
```

## 5. 安全建议

1. 定期更换管理员密码
2. 限制内网穿透的访问权限
3. 定期备份数据库文件
4. 关闭不必要的端口
5. 定期更新软件版本

## 6. 联系方式

如有问题，请联系系统管理员：
- 邮箱：admin@example.com
- 电话：138-0000-0000

---

**版本号：3.0**
**更新日期：2025-12-01**